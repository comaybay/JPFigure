@page "/user"
@using JPFigure.Entities;
@inject UserRepository userRepo;
@inject CartRepository cartRepo;
@inject NavigationManager _navigationManager
@inject JPFigureContext context
<NavBar></NavBar>
@if (_user != null) {
<div class="title_ctn">
    <h3>Tài khoản của bạn</h3>
    <div></div>
</div>
<div class="content_ctn">
    <div>
        <h4>THÔNG TIN TÀI KHOẢN</h4>
    </div>
    <div class="user_info_ctn">
        <p>Họ và tên:</p>
        <p class="user_name">@_user.Name</p>
    </div>
    <div class="user_info_ctn">
        <p>Email:</p>
        <p>@_user.Email</p>
    </div>
    <div class="user_info_ctn">
        <p>Địa chỉ:</p>
			<input placeholder="Địa chỉ..." @bind-value=@_address>
        <button @onclick=@UpdateAddress>Cập Nhập</button>
    </div>
</div>
<div class="bougth_product_ctn">
    <div>
        <h4 class="bougth_title">SẢN PHẨM ĐÃ MUA</h4>
    </div>
    @for (int i = 0; i < 2; i++)
    {
        <div class="bougth_ctn">
            <div class="image_ctn">
                <img src="Image/product1.png">
            </div>
            <div class="bougth_info_title">
                <div>
                    <span style="font-weight: bold">Nendoroid Swacchao! Attack on Titan Levi</span>
                </div>
                <div>
                    <span style="color: red">1,400,000₫</span>
                </div>
                <div>
                    <span>Số lượng: 2</span>
                </div>
            </div>
        </div>
    }
</div>
<div class="logout_ctn">
    <button>Đăng Xuất</button>
</div>
}
<BottomBar></BottomBar>

@code {
	[CascadingParameter]
	public Task<AuthenticationState> AuthenticationState { get; set; }

	private User _user;
	private string _address;

	protected override async Task OnInitializedAsync()
	{
		var userEmail = (await AuthenticationState).User?.FindFirst(ClaimTypes.Email)?.Value;

		_user = await userRepo.GetUser(userEmail);


	}

	public async Task UpdateAddress()
	{
		_user.Address = _address;
		await userRepo.UpdateUser(_user);
	}

}
